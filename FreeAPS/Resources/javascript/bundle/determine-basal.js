var freeaps_determineBasal;(()=>{var e={5546:(e,r,a)=>{var t=a(6880);function o(e,r){r||(r=0);var a=Math.pow(10,r);return Math.round(e*a)/a}function n(e,r){return"mmol/L"===r.out_units?o(e/18,1).toFixed(1):Math.round(e)}var i="";e.exports=function(e,r,a,s,l,u,m,d,c,g){var h={},p=new Date;if(g&&(p=g),void 0===s||void 0===s.current_basal)return h.error="Error: could not get current basal rate",h;var f=t(s.current_basal,s),v=f,b=new Date;g&&(b=g);var B,M=new Date(e.date),_=o((b-M)/60/1e3,1),x=e.glucose,S=e.noise;B=e.delta>-.5?"+"+o(e.delta,0):o(e.delta,0);var y=Math.min(e.delta,e.short_avgdelta),G=Math.min(e.short_avgdelta,e.long_avgdelta),C=Math.max(e.delta,e.short_avgdelta,e.long_avgdelta);(x<=10||38===x||S>=3)&&(h.reason="CGM is calibrating, in ??? state, or noise is high");if(x>60&&0==e.delta&&e.short_avgdelta>-1&&e.short_avgdelta<1&&e.long_avgdelta>-1&&e.long_avgdelta<1&&("fakecgm"==e.device?(console.error("CGM data is unchanged ("+x+"+"+e.delta+") for 5m w/ "+e.short_avgdelta+" mg/dL ~15m change & "+e.long_avgdelta+" mg/dL ~45m change"),console.error("Simulator mode detected (",e.device,"): continuing anyway")):!0),_>12||_<-5?h.reason="If current system time "+b+" is correct, then BG data is too old. The last BG data was read "+_+"m ago at "+M:0===e.short_avgdelta&&0===e.long_avgdelta&&(e.last_cal&&e.last_cal<3?h.reason="CGM was just calibrated":h.reason="CGM data is unchanged ("+x+"+"+e.delta+") for 5m w/ "+e.short_avgdelta+" mg/dL ~15m change & "+e.long_avgdelta+" mg/dL ~45m change"),x<=10||38===x||S>=3||_>12||_<-5||0===e.short_avgdelta&&0===e.long_avgdelta)return r.rate>=v?(h.reason+=". Canceling high temp basal of "+r.rate,h.deliverAt=p,h.temp="absolute",h.duration=0,h.rate=0,h):0===r.rate&&r.duration>30?(h.reason+=". Shortening "+r.duration+"m long zero temp to 30m. ",h.deliverAt=p,h.temp="absolute",h.duration=30,h.rate=0,h):(h.reason+=". Temp "+r.rate+" <= current basal "+v+"U/hr; doing nothing. ",h);var w,O,I,T=s.max_iob;if(void 0!==s.min_bg&&(O=s.min_bg),void 0!==s.max_bg&&(I=s.max_bg),void 0===s.min_bg||void 0===s.max_bg)return h.error="Error: could not determine target_bg. ",h;w=(s.min_bg+s.max_bg)/2;var A=s.exercise_mode||s.high_temptarget_raises_sensitivity,F=100;if(s.half_basal_exercise_target)var U=s.half_basal_exercise_target;else U=160;if(A&&s.temptargetSet&&w>F||s.low_temptarget_lowers_sensitivity&&s.temptargetSet&&w<F){var R=U-F;R+w-F>0?(sensitivityRatio=R/(R+w-F),sensitivityRatio=Math.min(sensitivityRatio,s.autosens_max),sensitivityRatio=o(sensitivityRatio,2)):sensitivityRatio=s.autosens_max,process.stderr.write("Sensitivity ratio set to "+sensitivityRatio+" based on temp target of "+w+"; ")}else void 0!==l&&l&&(sensitivityRatio=l.ratio,process.stderr.write("Autosens ratio: "+sensitivityRatio+"; "));if(sensitivityRatio&&(v=s.current_basal*sensitivityRatio,(v=t(v,s))!==f?process.stderr.write("Adjusting basal from "+f+" to "+v+"; "):process.stderr.write("Basal unchanged: "+v+"; ")),s.temptargetSet);else if(void 0!==l&&l&&(s.sensitivity_raises_target&&l.ratio<1||s.resistance_lowers_target&&l.ratio>1)){O=o((O-60)/l.ratio)+60,I=o((I-60)/l.ratio)+60;var j=o((w-60)/l.ratio)+60;w===(j=Math.max(80,j))?process.stderr.write("target_bg unchanged: "+j+"; "):process.stderr.write("target_bg from "+w+" to "+j+"; "),w=j}if(e.noise>=2){var D=Math.max(1.1,s.noisyCGMTargetMultiplier),E=(Math.min(250,s.maxRaw),o(Math.min(200,O*D))),q=o(Math.min(200,w*D)),W=o(Math.min(200,I*D));process.stderr.write("Raising target_bg for noisy / raw CGM data, from "+w+" to "+q+"; "),O=E,w=q,I=W}var z=O-.5*(O-40),L=o(s.sens,1),P=s.sens;if(void 0!==l&&l&&((P=o(P=s.sens/sensitivityRatio,1))!==L?process.stderr.write("ISF from "+L+" to "+P):process.stderr.write("ISF unchanged: "+P),i+="Autosense: Ratio "+sensitivityRatio+", ISF "+L+" -> "+P+"; "),console.error("; CR:",s.carb_ratio),P=function(e,r,a,t,n,s,l){if(!1===a.auto_isf)return console.error("autoISF disabled in Preferences"),e;if(void 0===a.autoisf_max)return console.error("autoISF_max not defined"),e;if(a.autoisf_max){console.error("autoISF enabled in Preferences"),console.error("autoISF hourly change: "+a.autoisf_hourlychange),console.error("autoISF max: "+a.autoisf_max),console.error("SMB Range Extension: "+a.smb_max_range_extension),console.error("SMB fraction of InsReq: "+a.smb_delivery_ratio);var u=t.autoISF_duration,m=t.autoISF_average,d=a.autoisf_hourlychange;if(0==n.mealCOB&&u>=10)if(m>r){var c=a.autoisf_max,g=u/60,h=d/r,p=1+g*h*(m-r),f=Math.min(c,p);console.error("ISFreductionLevel = "+f+" ;");var v=o(Math.max(f,l),2);console.error("dura05_weight = "+g+";  avg05_weight = "+h+"; levelISF = "+p+"; liftISF = "+v),console.error("autoISF reports "+e+" did not do it for "+u+"min; go more aggressive by "+o(p,2)),c<p&&console.error("autoISF reduction "+o(p,2)+" limited by autoisf_max "+c),e=o(a.sens/v,1),console.error("autoISF reports sens is now "+e),i+="autoISF -> "+e+", Ratio "+v+"; "}else console.error("autoISF by-passed; avg. glucose "+m+" below target "+r);else n.mealCOB>0?console.error("autoISF by-passed; mealCOB of "+o(n.mealCOB,1)):console.error("autoISF by-passed; BG is only "+u+"min at level "+m);return console.error("autoISF has run. Sens is now "+e),e}}(P,w,s,e,u,0,sensitivityRatio),void 0===a)return h.error="Error: iob_data undefined. ",h;var k,N=a;if(a.length,a.length>1&&(a=N[0]),void 0===a.activity||void 0===a.iob)return h.error="Error: iob_data missing some property. ",h;var Z=((k=void 0!==a.lastTemp?o((new Date(b).getTime()-a.lastTemp.date)/6e4):0)+r.duration)%30;if(console.error("currenttemp:",r,"lastTempAge:",k,"m","tempModulus:",Z,"m"),h.temp="absolute",h.deliverAt=p,d&&r&&a.lastTemp&&r.rate!==a.lastTemp.rate&&k>10&&r.duration)return h.reason="Warning: currenttemp rate "+r.rate+" != lastTemp rate "+a.lastTemp.rate+" from pumphistory; canceling temp",m.setTempBasal(0,0,s,h,r);if(r&&a.lastTemp&&r.duration>0){var $=k-a.lastTemp.duration;if($>5&&k>10)return h.reason="Warning: currenttemp running but lastTemp from pumphistory ended "+$+"m ago; canceling temp",m.setTempBasal(0,0,s,h,r)}var H=o(-a.activity*P*5,2),J=o(6*(y-H));if(J<0&&(J=o(6*(G-H)))<0&&(J=o(6*(e.long_avgdelta-H))),a.iob>0)var K=o(x-a.iob*P);else K=o(x-a.iob*Math.min(P,s.sens));var Q=K+J;if(void 0===Q||isNaN(Q))return h.error="Error: could not calculate eventualBG. ",h;var V=function(e,r,a){return o(a+(e-r)/24,1)}(w,Q,H);h={temp:"absolute",bg:x,tick:B,eventualBG:Q,insulinReq:0,reservoir:c,deliverAt:p,sensitivityRatio};var X=[],Y=[],ee=[],re=[];X.push(x),Y.push(x),re.push(x),ee.push(x);var ae=function(e,r,a,t){return r?!e.allowSMB_with_high_temptarget&&e.temptargetSet&&t>100?(console.error("SMB disabled due to high temptarget of",t),!1):!0===a.bwFound&&!1===e.A52_risk_enable?(console.error("SMB disabled due to Bolus Wizard activity in the last 6 hours."),!1):!0===e.enableSMB_always?(a.bwFound?console.error("Warning: SMB enabled within 6h of using Bolus Wizard: be sure to easy bolus 30s before using Bolus Wizard"):console.error("SMB enabled due to enableSMB_always"),!0):!0===e.enableSMB_with_COB&&a.mealCOB?(a.bwCarbs?console.error("Warning: SMB enabled with Bolus Wizard carbs: be sure to easy bolus 30s before using Bolus Wizard"):console.error("SMB enabled for COB of",a.mealCOB),!0):!0===e.enableSMB_after_carbs&&a.carbs?(a.bwCarbs?console.error("Warning: SMB enabled with Bolus Wizard carbs: be sure to easy bolus 30s before using Bolus Wizard"):console.error("SMB enabled for 6h after carb entry"),!0):!0===e.enableSMB_with_temptarget&&e.temptargetSet&&t<100?(a.bwFound?console.error("Warning: SMB enabled within 6h of using Bolus Wizard: be sure to easy bolus 30s before using Bolus Wizard"):console.error("SMB enabled for temptarget of",n(t,e)),!0):(console.error("SMB disabled (no enableSMB preferences active or no condition satisfied)"),!1):(console.error("SMB disabled (!microBolusAllowed)"),!1)}(s,d,u,w),te=s.enableUAM,oe=0,ne=0;oe=o(y-H,1);var ie=o(y-H,1);csf=P/s.carb_ratio,console.error("profile.sens:",s.sens,"sens:",P,"CSF:",csf);var se=o(30*csf*5/60,1);oe>se&&(console.error("Limiting carb impact from",oe,"to",se,"mg/dL/5m (",30,"g/h )"),oe=se);var le=3;sensitivityRatio&&(le/=sensitivityRatio);var ue=le;if(u.carbs){le=Math.max(le,u.mealCOB/20);var me=o((new Date(b).getTime()-u.lastCarbTime)/6e4),de=(u.carbs-u.mealCOB)/u.carbs;ue=o(ue=le+1.5*me/60,1),console.error("Last carbs",me,"minutes ago; remainingCATime:",ue,"hours;",o(100*de)+"% carbs absorbed")}var ce=Math.max(0,oe/5*60*ue/2)/csf,ge=90,he=1;s.remainingCarbsCap&&(ge=Math.min(90,s.remainingCarbsCap)),s.remainingCarbsFraction&&(he=Math.min(1,s.remainingCarbsFraction));var pe=1-he,fe=Math.max(0,u.mealCOB-ce-u.carbs*pe),ve=(fe=Math.min(ge,fe))*csf*5/60/(ue/2),be=o(u.slopeFromMaxDeviation,2),Be=o(u.slopeFromMinDeviation,2),Me=Math.min(be,-Be/3);ne=0===oe?0:Math.min(60*ue/5/2,Math.max(0,u.mealCOB*csf/oe)),console.error("Carb Impact:",oe,"mg/dL per 5m; CI Duration:",o(5*ne/60*2,1),"hours; remaining CI (",ue," peak):",o(ve,1),"mg/dL per 5m");var _e,xe,Se,ye,Ge,Ce=999,we=999,Oe=999,Ie=x,Te=999,Ae=999,Fe=999,Ue=999,Re=Q,je=x,De=x,Ee=0,qe=[],We=[];try{N.forEach((function(e){var r=o(-e.activity*P*5,2),a=o(-e.iobWithZeroTemp.activity*P*5,2),t=oe*(1-Math.min(1,Y.length/12));Re=Y[Y.length-1]+r+t;var n=re[re.length-1]+a,i=Math.max(0,Math.max(0,oe)*(1-X.length/Math.max(2*ne,1))),s=Math.min(X.length,12*ue-X.length),l=Math.max(0,s/(ue/2*12)*ve);i+l,qe.push(o(l,0)),We.push(o(i,0)),COBpredBG=X[X.length-1]+r+Math.min(0,t)+i+l;var u=Math.max(0,ie+ee.length*Me),m=Math.max(0,ie*(1-ee.length/Math.max(36,1))),d=Math.min(u,m);d>0&&(Ee=o(5*(ee.length+1)/60,1)),UAMpredBG=ee[ee.length-1]+r+Math.min(0,t)+d,Y.length<48&&Y.push(Re),X.length<48&&X.push(COBpredBG),ee.length<48&&ee.push(UAMpredBG),re.length<48&&re.push(n),COBpredBG<Te&&(Te=o(COBpredBG)),UAMpredBG<Ae&&(Ae=o(UAMpredBG)),Re<Fe&&(Fe=o(Re)),n<Ue&&(Ue=o(n));Y.length>18&&Re<Ce&&(Ce=o(Re)),Re>je&&(je=Re),(ne||ve>0)&&X.length>18&&COBpredBG<we&&(we=o(COBpredBG)),(ne||ve>0)&&COBpredBG>je&&(De=COBpredBG),te&&ee.length>12&&UAMpredBG<Oe&&(Oe=o(UAMpredBG)),te&&UAMpredBG>je&&UAMpredBG}))}catch(e){console.error("Problem with iobArray.  Optional feature Advanced Meal Assist disabled")}u.mealCOB&&(console.error("predCIs (mg/dL/5m):",We.join(" ")),console.error("remainingCIs:      ",qe.join(" "))),h.predBGs={},Y.forEach((function(e,r,a){a[r]=o(Math.min(401,Math.max(39,e)))}));for(var ze=Y.length-1;ze>12&&Y[ze-1]===Y[ze];ze--)Y.pop();for(h.predBGs.IOB=Y,Se=o(Y[Y.length-1]),re.forEach((function(e,r,a){a[r]=o(Math.min(401,Math.max(39,e)))})),ze=re.length-1;ze>6&&!(re[ze-1]>=re[ze]||re[ze]<=w);ze--)re.pop();if(h.predBGs.ZT=re,o(re[re.length-1]),u.mealCOB>0&&(oe>0||ve>0)){for(X.forEach((function(e,r,a){a[r]=o(Math.min(401,Math.max(39,e)))})),ze=X.length-1;ze>12&&X[ze-1]===X[ze];ze--)X.pop();h.predBGs.COB=X,ye=o(X[X.length-1]),Q=Math.max(Q,o(X[X.length-1]))}if(oe>0||ve>0){if(te){for(ee.forEach((function(e,r,a){a[r]=o(Math.min(401,Math.max(39,e)))})),ze=ee.length-1;ze>12&&ee[ze-1]===ee[ze];ze--)ee.pop();h.predBGs.UAM=ee,Ge=o(ee[ee.length-1]),ee[ee.length-1]&&(Q=Math.max(Q,o(ee[ee.length-1])))}h.eventualBG=Q}console.error("UAM Impact:",ie,"mg/dL per 5m; UAM Duration:",Ee,"hours"),Ce=Math.max(39,Ce),we=Math.max(39,we),Oe=Math.max(39,Oe),_e=o(Ce);var Le=u.mealCOB/u.carbs;xe=o(Oe<999&&we<999?(1-Le)*UAMpredBG+Le*COBpredBG:we<999?(Re+COBpredBG)/2:Oe<999?(Re+UAMpredBG)/2:Re),Ue>xe&&(xe=Ue),Ie=o(Ie=ne||ve>0?te?Le*Te+(1-Le)*Ae:Te:te?Ae:Fe);var Pe=Oe;if(Ue<z)Pe=(Oe+Ue)/2;else if(Ue<w){var ke=(Ue-z)/(w-z);Pe=(Oe+(Oe*ke+Ue*(1-ke)))/2}else Ue>Oe&&(Pe=(Oe+Ue)/2);if(Pe=o(Pe),u.carbs)if(!te&&we<999)_e=o(Math.max(Ce,we));else if(we<999){var Ne=Le*we+(1-Le)*Pe;_e=o(Math.max(Ce,we,Ne))}else _e=te?Pe:Ie;else te&&(_e=o(Math.max(Ce,Pe)));_e=Math.min(_e,xe),process.stderr.write("minPredBG: "+_e+" minIOBPredBG: "+Ce+" minZTGuardBG: "+Ue),we<999&&process.stderr.write(" minCOBPredBG: "+we),Oe<999&&process.stderr.write(" minUAMPredBG: "+Oe),console.error(" avgPredBG:",xe,"COB:",u.mealCOB,"/",u.carbs),De>x&&(_e=Math.min(_e,De)),h.COB=u.mealCOB,h.IOB=a.iob,h.BGI=H,h.deviation=n(J,s),h.ISF=n(P,s),h.CR=o(s.carb_ratio,2),h.target_bg=n(w,s),h.reason=i+"minPredBG "+n(_e,s)+", minGuardBG "+n(Ie,s)+", IOBpredBG "+n(Se,s),ye>0&&(h.reason+=", COBpredBG "+n(ye,s)),Ge>0&&(h.reason+=", UAMpredBG "+n(Ge,s)),h.reason+="; ";var Ze=K;Ze<40&&(Ze=Math.min(Ie,Ze));var $e,He=z-Ze,Je=240,Ke=240;if(u.mealCOB>0&&(oe>0||ve>0)){for(ze=0;ze<X.length;ze++)if(X[ze]<O){Je=5*ze;break}for(ze=0;ze<X.length;ze++)if(X[ze]<z){Ke=5*ze;break}}else{for(ze=0;ze<Y.length;ze++)if(Y[ze]<O){Je=5*ze;break}for(ze=0;ze<Y.length;ze++)if(Y[ze]<z){Ke=5*ze;break}}ae&&Ie<z&&(console.error("minGuardBG",n(Ie,s),"projected below",n(z,s),"- disabling SMB"),ae=!1),void 0===s.maxDelta_bg_threshold&&($e=.2),void 0!==s.maxDelta_bg_threshold&&($e=Math.min(s.maxDelta_bg_threshold,.3)),C>$e*x&&(console.error("maxDelta "+n(C,s)+" > "+100*$e+"% of BG "+n(x,s)+" - disabling SMB"),h.reason+="maxDelta "+n(C,s)+" > "+100*$e+"% of BG "+n(x,s)+": SMB disabled; ",ae=!1),console.error("BG projected to remain above",n(O,s),"for",Je,"minutes"),(Ke<240||Je<60)&&console.error("BG projected to remain above",n(z,s),"for",Ke,"minutes");var Qe=Ke,Ve=s.current_basal*P*Qe/60,Xe=Math.max(0,u.mealCOB-.25*u.carbs),Ye=(He-Ve)/csf-Xe;if(Ve=o(Ve),Ye=o(Ye),console.error("naive_eventualBG:",K,"bgUndershoot:",He,"zeroTempDuration:",Qe,"zeroTempEffect:",Ve,"carbsReq:",Ye),Ye>=s.carbsReqThreshold&&Ke<=45&&(h.carbsReq=Ye,h.reason+=Ye+" add'l carbs req w/in "+Ke+"m; "),x<z&&a.iob<20*-s.current_basal/60&&y>0&&y>V)h.reason+="IOB "+a.iob+" < "+o(20*-s.current_basal/60,2),h.reason+=" and minDelta "+n(y,s)+" > expectedDelta "+n(V,s)+"; ";else if(x<z||Ie<z){h.reason+="minGuardBG "+n(Ie,s)+"<"+n(z,s);var er=(He=w-Ie)/P,rr=o(60*er/s.current_basal);return rr=30*o(rr/30),rr=Math.min(120,Math.max(30,rr)),m.setTempBasal(0,rr,s,h,r)}if(s.skip_neutral_temps&&h.deliverAt.getMinutes()>=55)return h.reason+="; Canceling temp at "+h.deliverAt.getMinutes()+"m past the hour. ",m.setTempBasal(0,0,s,h,r);if(Q<O){if(h.reason+="Eventual BG "+n(Q,s)+" < "+n(O,s),y>V&&y>0&&!Ye)return K<40?(h.reason+=", naive_eventualBG < 40. ",m.setTempBasal(0,30,s,h,r)):(e.delta>y?h.reason+=", but Delta "+n(B,s)+" > expectedDelta "+n(V,s):h.reason+=", but Min. Delta "+y.toFixed(2)+" > Exp. Delta "+n(V,s),r.duration>15&&t(v,s)===t(r.rate,s)?(h.reason+=", temp "+r.rate+" ~ req "+v+"U/hr. ",h):(h.reason+="; setting current basal of "+v+" as temp. ",m.setTempBasal(v,30,s,h,r)));var ar=2*Math.min(0,(Q-w)/P);ar=o(ar,2);var tr=Math.min(0,(K-w)/P);if(tr=o(tr,2),y<0&&y>V)ar=o(ar*(y/V),2);var or=v+2*ar;or=t(or,s);var nr=r.duration*(r.rate-v)/60;if(nr<Math.min(ar,tr)-.3*v)return h.reason+=", "+r.duration+"m@"+r.rate.toFixed(2)+" is a lot less than needed. ",m.setTempBasal(or,30,s,h,r);if(void 0!==r.rate&&r.duration>5&&or>=.8*r.rate)return h.reason+=", temp "+r.rate+" ~< req "+or+"U/hr. ",h;if(or<=0){if((rr=o(60*(er=(He=w-K)/P)/s.current_basal))<0?rr=0:(rr=30*o(rr/30),rr=Math.min(120,Math.max(0,rr))),rr>0)return h.reason+=", setting "+rr+"m zero temp. ",m.setTempBasal(or,rr,s,h,r)}else h.reason+=", setting "+or+"U/hr. ";return m.setTempBasal(or,30,s,h,r)}if(y<V&&(!d||!ae))return e.delta<y?h.reason+="Eventual BG "+n(Q,s)+" > "+n(O,s)+" but Delta "+n(B,s)+" < Exp. Delta "+n(V,s):h.reason+="Eventual BG "+n(Q,s)+" > "+n(O,s)+" but Min. Delta "+y.toFixed(2)+" < Exp. Delta "+n(V,s),r.duration>15&&t(v,s)===t(r.rate,s)?(h.reason+=", temp "+r.rate+" ~ req "+v+"U/hr. ",h):(h.reason+="; setting current basal of "+v+" as temp. ",m.setTempBasal(v,30,s,h,r));if(Math.min(Q,_e)<I&&(!d||!ae))return h.reason+=n(Q,s)+"-"+n(_e,s)+" in range: no temp required",r.duration>15&&t(v,s)===t(r.rate,s)?(h.reason+=", temp "+r.rate+" ~ req "+v+"U/hr. ",h):(h.reason+="; setting current basal of "+v+" as temp. ",m.setTempBasal(v,30,s,h,r));if(Q>=I&&(h.reason+="Eventual BG "+n(Q,s)+" >= "+n(I,s)+", "),a.iob>T)return h.reason+="IOB "+o(a.iob,2)+" > max_iob "+T,r.duration>15&&t(v,s)===t(r.rate,s)?(h.reason+=", temp "+r.rate+" ~ req "+v+"U/hr. ",h):(h.reason+="; setting current basal of "+v+" as temp. ",m.setTempBasal(v,30,s,h,r));(ar=o((Math.min(_e,Q)-w)/P,2))>T-a.iob&&(h.reason+="max_iob "+T+", ",ar=T-a.iob),or=t(or=v+2*ar,s),ar=o(ar,3),h.insulinReq=ar;var ir=o((new Date(b).getTime()-a.lastBolusTime)/6e4,1);if(d&&ae&&x>z){var sr=o(u.mealCOB/s.carb_ratio,3);if(!1===s.auto_isf){console.error("autoISF disabled, don't adjust SMB range");var lr=1}else lr=s.smb_max_range_extension;if(lr>1&&console.error("SMB max range extended from default by factor "+lr),void 0===s.maxSMBBasalMinutes){var ur=o(lr*s.current_basal*30/60,1);console.error("profile.maxSMBBasalMinutes undefined: defaulting to 30m")}else a.iob>sr&&a.iob>0?(console.error("IOB",a.iob,"> COB",u.mealCOB+"; mealInsulinReq =",sr),s.maxUAMSMBBasalMinutes?(console.error("profile.maxUAMSMBBasalMinutes:",s.maxUAMSMBBasalMinutes,"profile.current_basal:",s.current_basal),ur=o(lr*s.current_basal*s.maxUAMSMBBasalMinutes/60,1)):(console.error("profile.maxUAMSMBBasalMinutes undefined: defaulting to 30m"),ur=o(30*s.current_basal/60,1))):(console.error("profile.maxSMBBasalMinutes:",s.maxSMBBasalMinutes,"profile.current_basal:",s.current_basal),ur=o(lr*s.current_basal*s.maxSMBBasalMinutes/60,1));var mr=s.bolus_increment,dr=1/mr;if(!1===s.auto_isf)console.error("autoISF disabled, don't adjust SMB ratio"),cr=.5;else var cr=s.smb_delivery_ratio;cr>.5&&console.error("SMB ratio increased from default 0.5 to "+cr);var gr=Math.floor(Math.min(ar*cr,ur)*dr)/dr;rr=o(60*(er=(w-(K+Ce)/2)/P)/s.current_basal),ar>0&&gr<mr&&(rr=0);var hr=0;rr<=0?rr=0:rr>=30?(rr=30*o(rr/30),rr=Math.min(60,Math.max(0,rr))):(hr=o(v*rr/30,2),rr=30),h.reason+=" insulinReq "+ar,gr>=ur&&(h.reason+="; maxBolus "+ur),rr>0&&(h.reason+="; setting "+rr+"m low temp of "+hr+"U/h"),h.reason+=". ";var pr=3;s.SMBInterval&&(pr=Math.min(10,Math.max(1,s.SMBInterval)));var fr=o(pr-ir,0),vr=o(60*(pr-ir),0)%60;if(console.error("naive_eventualBG",K+",",rr+"m "+hr+"U/h temp needed; last bolus",ir+"m ago; maxBolus: "+ur),ir>pr?gr>0&&(h.units=gr,h.reason+="Microbolusing "+gr+"U. "):h.reason+="Waiting "+fr+"m "+vr+"s to microbolus again. ",rr>0)return h.rate=hr,h.duration=rr,h}var br=m.getMaxSafeBasal(s);return or>br&&(h.reason+="adj. req. rate: "+or+" to maxSafeBasal: "+br+", ",or=t(br,s)),(nr=r.duration*(r.rate-v)/60)>=2*ar?(h.reason+=r.duration+"m@"+r.rate.toFixed(2)+" > 2 * insulinReq. Setting temp basal of "+or+"U/hr. ",m.setTempBasal(or,30,s,h,r)):void 0===r.duration||0===r.duration?(h.reason+="no temp, setting "+or+"U/hr. ",m.setTempBasal(or,30,s,h,r)):r.duration>5&&t(or,s)<=t(r.rate,s)?(h.reason+="temp "+r.rate+" >~ req "+or+"U/hr. ",h):(h.reason+="temp "+r.rate+"<"+or+"U/hr. ",m.setTempBasal(or,30,s,h,r))}},6880:(e,r,a)=>{var t=a(6654);e.exports=function(e,r){var a=20;void 0!==r&&"string"==typeof r.model&&(t(r.model,"54")||t(r.model,"23"))&&(a=40);return e<1?Math.round(e*a)/a:e<10?Math.round(20*e)/20:Math.round(10*e)/10}},2705:(e,r,a)=>{var t=a(5639).Symbol;e.exports=t},9932:e=>{e.exports=function(e,r){for(var a=-1,t=null==e?0:e.length,o=Array(t);++a<t;)o[a]=r(e[a],a,e);return o}},9750:e=>{e.exports=function(e,r,a){return e==e&&(void 0!==a&&(e=e<=a?e:a),void 0!==r&&(e=e>=r?e:r)),e}},4239:(e,r,a)=>{var t=a(2705),o=a(9607),n=a(2333),i=t?t.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?o(e):n(e)}},531:(e,r,a)=>{var t=a(2705),o=a(9932),n=a(1469),i=a(3448),s=t?t.prototype:void 0,l=s?s.toString:void 0;e.exports=function e(r){if("string"==typeof r)return r;if(n(r))return o(r,e)+"";if(i(r))return l?l.call(r):"";var a=r+"";return"0"==a&&1/r==-Infinity?"-0":a}},7561:(e,r,a)=>{var t=a(7990),o=/^\s+/;e.exports=function(e){return e?e.slice(0,t(e)+1).replace(o,""):e}},1957:(e,r,a)=>{var t="object"==typeof a.g&&a.g&&a.g.Object===Object&&a.g;e.exports=t},9607:(e,r,a)=>{var t=a(2705),o=Object.prototype,n=o.hasOwnProperty,i=o.toString,s=t?t.toStringTag:void 0;e.exports=function(e){var r=n.call(e,s),a=e[s];try{e[s]=void 0;var t=!0}catch(e){}var o=i.call(e);return t&&(r?e[s]=a:delete e[s]),o}},2333:e=>{var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},5639:(e,r,a)=>{var t=a(1957),o="object"==typeof self&&self&&self.Object===Object&&self,n=t||o||Function("return this")();e.exports=n},7990:e=>{var r=/\s/;e.exports=function(e){for(var a=e.length;a--&&r.test(e.charAt(a)););return a}},6654:(e,r,a)=>{var t=a(9750),o=a(531),n=a(554),i=a(9833);e.exports=function(e,r,a){e=i(e),r=o(r);var s=e.length,l=a=void 0===a?s:t(n(a),0,s);return(a-=r.length)>=0&&e.slice(a,l)==r}},1469:e=>{var r=Array.isArray;e.exports=r},3218:e=>{e.exports=function(e){var r=typeof e;return null!=e&&("object"==r||"function"==r)}},7005:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},3448:(e,r,a)=>{var t=a(4239),o=a(7005);e.exports=function(e){return"symbol"==typeof e||o(e)&&"[object Symbol]"==t(e)}},8601:(e,r,a)=>{var t=a(4841),o=1/0;e.exports=function(e){return e?(e=t(e))===o||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},554:(e,r,a)=>{var t=a(8601);e.exports=function(e){var r=t(e),a=r%1;return r==r?a?r-a:r:0}},4841:(e,r,a)=>{var t=a(7561),o=a(3218),n=a(3448),i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,l=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(n(e))return NaN;if(o(e)){var r="function"==typeof e.valueOf?e.valueOf():e;e=o(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=t(e);var a=s.test(e);return a||l.test(e)?u(e.slice(2),a?2:8):i.test(e)?NaN:+e}},9833:(e,r,a)=>{var t=a(531);e.exports=function(e){return null==e?"":t(e)}}},r={};function a(t){var o=r[t];if(void 0!==o)return o.exports;var n=r[t]={exports:{}};return e[t](n,n.exports,a),n.exports}a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var t=a(5546);freeaps_determineBasal=t})();